<template>
  <div class="space-y-8">
    <!-- Hero Section -->
    <section class="text-center py-12 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl">
      <div class="max-w-4xl mx-auto px-4">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
          技術記事を<span class="text-blue-600">共有</span>しよう
        </h1>
        <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
          開発者のためのナレッジプラットフォーム。あなたの知識を記事にして、コミュニティと共有しましょう。
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <NuxtLink
            v-if="!isLoggedIn"
            to="/signup"
            class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
          >
            今すぐ始める
          </NuxtLink>
          <NuxtLink
            v-else
            to="/write"
            class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
          >
            記事を書く
          </NuxtLink>
          <NuxtLink
            to="/explore"
            class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
          >
            記事を探す
          </NuxtLink>
        </div>
      </div>
    </section>

    <!-- Trending Articles Section -->
    <section data-testid="trending-articles">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">トレンド記事</h2>
        <NuxtLink
          to="/trending"
          class="text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors"
          data-testid="explore-link"
        >
          すべて見る →
        </NuxtLink>
      </div>

      <!-- Loading State -->
      <div v-if="articlesLoading" class="space-y-4" data-testid="loading-articles">
        <div v-for="i in 3" :key="i" class="animate-pulse">
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            <div class="h-4 bg-gray-200 rounded w-3/4 mb-3"></div>
            <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-2/3 mb-4"></div>
            <div class="flex items-center space-x-4">
              <div class="h-8 w-8 bg-gray-200 rounded-full"></div>
              <div class="h-3 bg-gray-200 rounded w-24"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Articles Grid -->
      <div v-else-if="(popularArticles || []).length > 0" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        <!-- Temporarily disabled ArticleCard component -->
        <div v-for="article in popularArticles" :key="article.id" class="bg-white rounded-lg border p-4">
          <h3 class="font-semibold">{{ article?.title || 'Article Title' }}</h3>
          <p class="text-gray-600 text-sm">{{ article?.excerpt || 'Article excerpt...' }}</p>
        </div>
      </div>

      <!-- Empty State -->
      <div v-else class="text-center py-12" data-testid="no-articles">
        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">記事がありません</h3>
        <p class="text-gray-500 mb-4">まだ記事が投稿されていません。最初の記事を投稿してみませんか？</p>
        <NuxtLink
          v-if="isLoggedIn"
          to="/write"
          class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
        >
          記事を書く
        </NuxtLink>
      </div>
    </section>

    <!-- Recent Articles Section -->
    <section data-testid="recent-articles">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">最新記事</h2>
        <NuxtLink
          to="/explore?sort=newest"
          class="text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors"
        >
          すべて見る →
        </NuxtLink>
      </div>

      <!-- Loading State -->
      <div v-if="articlesLoading" class="space-y-4">
        <div v-for="i in 5" :key="i" class="animate-pulse">
          <div class="bg-white rounded-lg border border-gray-200 p-4">
            <div class="flex items-start space-x-4">
              <div class="h-16 w-16 bg-gray-200 rounded-lg"></div>
              <div class="flex-1">
                <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
                <div class="h-3 bg-gray-200 rounded w-1/3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Articles List -->
      <div v-else-if="(recentArticles || []).length > 0" class="space-y-4">
        <!-- Temporarily disabled ArticleListItem component -->
        <div v-for="article in (recentArticles || [])" :key="article.id" class="bg-white rounded-lg border p-4">
          <h3 class="font-semibold">{{ article?.title || 'Recent Article' }}</h3>
          <p class="text-gray-600 text-sm">{{ article?.excerpt || 'Recent article excerpt...' }}</p>
        </div>
      </div>

      <!-- Empty State -->
      <div v-else class="text-center py-8">
        <p class="text-gray-500">最新の記事がありません</p>
      </div>
    </section>

    <!-- Categories Section -->
    <section>
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">カテゴリ</h2>
        <NuxtLink
          to="/explore"
          class="text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors"
        >
          すべて見る →
        </NuxtLink>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
        <NuxtLink
          v-for="category in (categories || []).filter(c => c && c.name)"
          :key="category.id"
          :to="`/categories/${category.id}`"
          class="group bg-white rounded-lg border border-gray-200 p-4 hover:border-gray-300 hover:shadow-sm transition-all"
        >
          <div
            class="w-8 h-8 rounded-lg mb-3 flex items-center justify-center text-white text-sm font-bold"
            :style="{ backgroundColor: category.color }"
          >
            {{ category.name.charAt(0) }}
          </div>
          <h3 class="font-medium text-gray-900 group-hover:text-blue-600 transition-colors text-sm">
            {{ category.name }}
          </h3>
          <p class="text-xs text-gray-500 mt-1">
            {{ category.articleCount || 0 }}記事
          </p>
        </NuxtLink>
      </div>
    </section>

    <!-- Popular Tags Section -->
    <section>
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">人気タグ</h2>
        <NuxtLink
          to="/tags"
          class="text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors"
        >
          すべて見る →
        </NuxtLink>
      </div>

      <div class="flex flex-wrap gap-2">
        <NuxtLink
          v-for="tag in (popularTags || []).filter(t => t && t.name)"
          :key="tag.id"
          :to="`/tags/${tag.id}`"
          class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800 hover:bg-gray-200 transition-colors"
        >
          #{{ tag.name }}
          <span class="ml-1 text-xs text-gray-500">({{ tag.count || 0 }})</span>
        </NuxtLink>
      </div>
    </section>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useAuth } from '~/composables/useAuth'
import { useArticles } from '~/composables/useArticles'

// SEO
useHead({
  title: 'Article Platform - 技術記事共有プラットフォーム',
  meta: [
    {
      name: 'description',
      content: '開発者のための技術記事共有プラットフォーム。あなたの知識を記事にして、コミュニティと共有しましょう。'
    }
  ]
})

// Composables - Temporarily disabled
// const { user, isLoggedIn } = useAuth()
// const {
//   getPopularArticles,
//   getRecentArticles,
//   listCategories,
//   getPopularTags,
//   loading: articlesLoading
// } = useArticles()

// Mock data for now
const user = ref(null)
const isLoggedIn = ref(false)
const articlesLoading = ref(false)

// State
const popularArticles = ref([])
const recentArticles = ref([])
const categories = ref([])
const popularTags = ref([])

// Methods
const loadData = async () => {
  // Simplified data loading without API calls

  // Mock categories data for now
  categories.value = [
    { id: 'tech', name: 'Technology', color: '#3B82F6', articleCount: 45 },
    { id: 'javascript', name: 'JavaScript', color: '#F59E0B', articleCount: 32 },
    { id: 'react', name: 'React', color: '#06B6D4', articleCount: 28 },
    { id: 'vue', name: 'Vue.js', color: '#10B981', articleCount: 25 },
    { id: 'nodejs', name: 'Node.js', color: '#84CC16', articleCount: 20 },
    { id: 'python', name: 'Python', color: '#8B5CF6', articleCount: 18 }
  ]

  // Mock popular tags for now
  popularTags.value = [
    { id: 'javascript', name: 'JavaScript', count: 150 },
    { id: 'typescript', name: 'TypeScript', count: 120 },
    { id: 'react', name: 'React', count: 100 },
    { id: 'vue', name: 'Vue.js', count: 90 },
    { id: 'nodejs', name: 'Node.js', count: 85 },
    { id: 'python', name: 'Python', count: 80 },
    { id: 'docker', name: 'Docker', count: 60 },
    { id: 'kubernetes', name: 'Kubernetes', count: 45 },
    { id: 'aws', name: 'AWS', count: 40 },
    { id: 'nextjs', name: 'Next.js', count: 35 }
  ]
}

// Lifecycle
onMounted(() => {
  loadData()
})
</script>